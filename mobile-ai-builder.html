<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Scenario Builder Mobile</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .content {
            padding: 20px;
        }
        
        .step {
            display: none;
            animation: slideIn 0.3s ease-out;
        }
        
        .step.active {
            display: block;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 16px;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 16px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s;
            -webkit-appearance: none;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        textarea {
            height: 120px;
            resize: vertical;
        }
        
        .btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: #6c757d;
            margin-right: 10px;
            width: calc(50% - 5px);
        }
        
        .btn-primary {
            width: calc(50% - 5px);
        }
        
        .progress {
            height: 4px;
            background: #e1e5e9;
            border-radius: 2px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px;
            transition: width 0.3s ease;
        }
        
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .feedback-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #667eea;
        }
        
        .feedback-item h4 {
            margin-bottom: 8px;
            color: #495057;
        }
        
        .feedback-item p {
            margin-bottom: 8px;
            color: #6c757d;
            font-size: 14px;
        }
        
        .key-input {
            margin-top: 10px;
        }
        
        .loading {
            text-align: center;
            padding: 40px 20px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e1e5e9;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .examples {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .examples h3 {
            margin-bottom: 10px;
            color: #495057;
            font-size: 16px;
        }
        
        .example {
            background: white;
            padding: 12px;
            border-radius: 8px;
            margin: 8px 0;
            cursor: pointer;
            border: 1px solid #dee2e6;
            transition: all 0.2s;
            font-size: 14px;
        }
        
        .example:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }
        
        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .step-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e1e5e9;
            margin: 0 4px;
            transition: all 0.3s;
        }
        
        .step-dot.active {
            background: #667eea;
            transform: scale(1.2);
        }
        
        .step-dot.completed {
            background: #28a745;
        }
        
        @media (max-width: 480px) {
            .container {
                margin: 5px;
                border-radius: 12px;
            }
            
            .header {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 20px;
            }
            
            .content {
                padding: 15px;
            }
            
            .btn-secondary, .btn-primary {
                width: 100%;
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ AI Scenario Builder</h1>
            <p>Create Make.com automations with AI assistance</p>
        </div>
        
        <div class="content">
            <div class="step-indicator">
                <div class="step-dot active" data-step="1"></div>
                <div class="step-dot" data-step="2"></div>
                <div class="step-dot" data-step="3"></div>
                <div class="step-dot" data-step="4"></div>
            </div>
            
            <div class="progress">
                <div class="progress-bar" style="width: 25%"></div>
            </div>
            
            <!-- Step 1: Configuration -->
            <div class="step active" id="step1">
                <h2>‚öôÔ∏è Configuration</h2>
                <div class="form-group">
                    <label for="webhookUrl">Make.com Webhook URL:</label>
                    <input type="url" id="webhookUrl" placeholder="https://hook.us1.make.com/..." value="https://hook.us2.make.com/l4hnd2qdxuivmeix2jrwmva6c495zlwe" required>
                    <small style="color: #666; font-size: 12px;">Get this from your Make.com scenario Module 1</small>
                </div>
                <button class="btn" onclick="nextStep()">Continue</button>
            </div>
            
            <!-- Step 2: Automation Request -->
            <div class="step" id="step2">
                <h2>üìù Describe Your Automation</h2>
                
                <div class="examples">
                    <h3>üí° Quick Examples</h3>
                    <div class="example" onclick="setExample('Send me daily weather emails at 8 AM')">
                        üìß Daily weather email automation
                    </div>
                    <div class="example" onclick="setExample('When I post on Instagram, share to Twitter and LinkedIn')">
                        üì± Social media cross-posting
                    </div>
                    <div class="example" onclick="setExample('Monitor Google Sheets and send Slack notifications')">
                        üìä Sheets to Slack alerts
                    </div>
                    <div class="example" onclick="setExample('Create Notion pages from email attachments')">
                        üìù Email to Notion automation
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="description">What do you want to automate?</label>
                    <textarea id="description" placeholder="Describe your automation in detail..." required></textarea>
                </div>
                
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-secondary" onclick="prevStep()">Back</button>
                    <button class="btn btn-primary" onclick="generateScenario()">Generate</button>
                </div>
            </div>
            
            <!-- Step 3: Processing -->
            <div class="step" id="step3">
                <div class="loading">
                    <div class="spinner"></div>
                    <h3>ü§ñ AI is creating your scenario...</h3>
                    <p>This may take 10-30 seconds</p>
                </div>
            </div>
            
            <!-- Step 4: Results & Feedback -->
            <div class="step" id="step4">
                <h2>‚úÖ Scenario Generated!</h2>
                <div id="results"></div>
                <div id="feedback-section"></div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="startOver()">Start Over</button>
                    <button class="btn btn-primary" onclick="downloadBlueprint()">Download</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        let scenarioData = null;
        let requiredKeys = [];
        
        function updateProgress() {
            const progress = (currentStep / 4) * 100;
            document.querySelector('.progress-bar').style.width = progress + '%';
            
            // Update step indicators
            document.querySelectorAll('.step-dot').forEach((dot, index) => {
                const stepNum = index + 1;
                dot.classList.remove('active', 'completed');
                
                if (stepNum < currentStep) {
                    dot.classList.add('completed');
                } else if (stepNum === currentStep) {
                    dot.classList.add('active');
                }
            });
        }
        
        function showStep(step) {
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('step' + step).classList.add('active');
            currentStep = step;
            updateProgress();
        }
        
        function nextStep() {
            if (currentStep === 1) {
                const webhookUrl = document.getElementById('webhookUrl').value;
                if (!webhookUrl || !webhookUrl.includes('hook.') || !webhookUrl.includes('make.com')) {
                    alert('Please enter a valid Make.com webhook URL');
                    return;
                }
            }
            
            if (currentStep < 4) {
                showStep(currentStep + 1);
            }
        }
        
        function prevStep() {
            if (currentStep > 1) {
                showStep(currentStep - 1);
            }
        }
        
        function setExample(text) {
            document.getElementById('description').value = text;
        }
        
        async function generateScenario() {
            const webhookUrl = document.getElementById('webhookUrl').value;
            const description = document.getElementById('description').value;
            
            if (!description.trim()) {
                alert('Please describe what you want to automate');
                return;
            }
            
            showStep(3); // Show loading
            
            try {
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        description: description,
                        callback_url: window.location.origin + '/callback'
                    })
                });
                
                if (response.ok) {
                    // Simulate AI processing time
                    setTimeout(() => {
                        simulateScenarioResponse(description);
                    }, 3000);
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
            } catch (error) {
                showError('Failed to generate scenario: ' + error.message);
                showStep(2);
            }
        }
        
        function simulateScenarioResponse(description) {
            // Simulate a realistic AI response
            scenarioData = {
                blueprint: { name: "Generated Scenario", flow: [] },
                setup_instructions: [
                    "1. Create accounts for required services",
                    "2. Generate API keys and tokens",
                    "3. Configure connections in Make.com",
                    "4. Test the scenario"
                ],
                required_services: detectRequiredServices(description),
                configuration_notes: "Follow the setup instructions carefully."
            };
            
            requiredKeys = extractRequiredKeys(scenarioData.required_services);
            displayResults();
            showStep(4);
        }
        
        function detectRequiredServices(description) {
            const services = [];
            const desc = description.toLowerCase();
            
            if (desc.includes('email') || desc.includes('gmail')) {
                services.push({
                    name: 'Gmail',
                    signup_url: 'https://gmail.com',
                    api_docs: 'https://developers.google.com/gmail/api',
                    required_credentials: ['client_id', 'client_secret', 'refresh_token']
                });
            }
            
            if (desc.includes('slack')) {
                services.push({
                    name: 'Slack',
                    signup_url: 'https://slack.com',
                    api_docs: 'https://api.slack.com',
                    required_credentials: ['bot_token']
                });
            }
            
            if (desc.includes('sheets') || desc.includes('google')) {
                services.push({
                    name: 'Google Sheets',
                    signup_url: 'https://sheets.google.com',
                    api_docs: 'https://developers.google.com/sheets/api',
                    required_credentials: ['service_account_json']
                });
            }
            
            if (desc.includes('twitter')) {
                services.push({
                    name: 'Twitter',
                    signup_url: 'https://twitter.com',
                    api_docs: 'https://developer.twitter.com',
                    required_credentials: ['api_key', 'api_secret', 'access_token', 'access_token_secret']
                });
            }
            
            if (desc.includes('weather')) {
                services.push({
                    name: 'OpenWeatherMap',
                    signup_url: 'https://openweathermap.org/api',
                    api_docs: 'https://openweathermap.org/api',
                    required_credentials: ['api_key']
                });
            }
            
            return services;
        }
        
        function extractRequiredKeys(services) {
            const keys = [];
            services.forEach(service => {
                service.required_credentials.forEach(cred => {
                    keys.push({
                        service: service.name,
                        key: cred,
                        value: '',
                        configured: false
                    });
                });
            });
            return keys;
        }
        
        function displayResults() {
            const resultsDiv = document.getElementById('results');
            const feedbackDiv = document.getElementById('feedback-section');
            
            resultsDiv.innerHTML = `
                <div class="success">
                    <h4>üéâ Scenario Generated Successfully!</h4>
                    <p><strong>Services needed:</strong> ${scenarioData.required_services.map(s => s.name).join(', ')}</p>
                    <p><strong>Setup steps:</strong> ${scenarioData.setup_instructions.length} steps</p>
                </div>
            `;
            
            if (requiredKeys.length > 0) {
                feedbackDiv.innerHTML = `
                    <div class="warning">
                        <h4>üîë API Keys & Credentials Required</h4>
                        <p>Please provide the following credentials to complete setup:</p>
                    </div>
                    <div id="keys-container"></div>
                `;
                
                displayKeyInputs();
            }
        }
        
        function displayKeyInputs() {
            const container = document.getElementById('keys-container');
            
            requiredKeys.forEach((keyInfo, index) => {
                const keyDiv = document.createElement('div');
                keyDiv.className = 'feedback-item';
                keyDiv.innerHTML = `
                    <h4>${keyInfo.service} - ${keyInfo.key}</h4>
                    <p>Required for ${keyInfo.service} integration</p>
                    <div class="key-input">
                        <input type="password" 
                               id="key-${index}" 
                               placeholder="Enter your ${keyInfo.key}"
                               onchange="updateKey(${index}, this.value)">
                        <small style="color: #666;">Get this from: ${getKeyInstructions(keyInfo.service, keyInfo.key)}</small>
                    </div>
                `;
                container.appendChild(keyDiv);
            });
        }
        
        function getKeyInstructions(service, key) {
            const instructions = {
                'Gmail': 'Google Cloud Console ‚Üí APIs & Services ‚Üí Credentials',
                'Slack': 'Slack API ‚Üí Your Apps ‚Üí OAuth & Permissions',
                'Google Sheets': 'Google Cloud Console ‚Üí Service Accounts',
                'Twitter': 'Twitter Developer Portal ‚Üí Apps ‚Üí Keys and tokens',
                'OpenWeatherMap': 'OpenWeatherMap ‚Üí API keys'
            };
            return instructions[service] || 'Service documentation';
        }
        
        function updateKey(index, value) {
            requiredKeys[index].value = value;
            requiredKeys[index].configured = value.length > 0;
            
            // Update visual feedback
            const input = document.getElementById(`key-${index}`);
            input.style.borderColor = value.length > 0 ? '#28a745' : '#e1e5e9';
        }
        
        function downloadBlueprint() {
            const configuredKeys = requiredKeys.filter(k => k.configured);
            
            if (configuredKeys.length < requiredKeys.length) {
                const missing = requiredKeys.filter(k => !k.configured);
                alert(`Please configure these keys first: ${missing.map(k => k.service + ' ' + k.key).join(', ')}`);
                return;
            }
            
            // Create enhanced blueprint with user's keys
            const enhancedBlueprint = {
                ...scenarioData,
                user_credentials: requiredKeys,
                generated_at: new Date().toISOString(),
                mobile_configured: true
            };
            
            const blob = new Blob([JSON.stringify(enhancedBlueprint, null, 2)], {
                type: 'application/json'
            });
            
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ai-generated-scenario.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function startOver() {
            currentStep = 1;
            scenarioData = null;
            requiredKeys = [];
            document.getElementById('description').value = '';
            document.getElementById('results').innerHTML = '';
            document.getElementById('feedback-section').innerHTML = '';
            showStep(1);
        }
        
        function showError(message) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <div class="error">
                    <h4>‚ùå Error</h4>
                    <p>${message}</p>
                </div>
            `;
        }
        
        // Initialize
        updateProgress();
    </script>
</body>
</html> 